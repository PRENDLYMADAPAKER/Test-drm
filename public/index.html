<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IPTV Proxy App</title>
  <style>
    body { margin: 0; background: #111; color: #fff; font-family: sans-serif; }
    #container { display: flex; height: 100vh; }
    #sidebar { width: 250px; background: #222; overflow-y: auto; padding: 10px; }
    #main { flex: 1; display: flex; flex-direction: column; }
    video { width: 100%; height: calc(100vh - 50px); background: black; }
    .channel { padding: 10px; cursor: pointer; border-bottom: 1px solid #444; }
    .channel:hover { background: #333; }
    h2 { margin: 0 0 10px 0; }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <h2>Channels</h2>
      <div id="channelList"></div>
    </div>
    <div id="main">
      <video id="video" controls autoplay></video>
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const channelList = document.getElementById('channelList');

    fetch('channels.json')
      .then(res => res.json())
      .then(channels => {
        channels.forEach(channel => {
          const div = document.createElement('div');
          div.className = 'channel';
          div.innerText = channel.name;
          div.onclick = () => playChannel(channel);
          channelList.appendChild(div);
        });

        if (channels.length > 0) playChannel(channels[0]);
      });

    function playChannel(channel) {
      video.pause();
      if (window.hls) window.hls.destroy();

      const version = channel.category.includes('TheTVApp') ? '1.1.5' : '1.4.12';
      const script = document.createElement('script');
      script.src = `https://cdn.jsdelivr.net/npm/hls.js@${version}/dist/hls.min.js`;

      script.onload = () => {
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(channel.url);
          hls.attachMedia(video);
          window.hls = hls;
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = channel.url;
        } else {
          alert('Your browser does not support HLS.');
        }
      };

      document.head.appendChild(script);
    }
  </script>
</body>
</html>
